import pandas as pd
import matplotlib.pyplot as plt

# File path and sheet names
file_path = "/Volumes/navy-fip4-ya-dev/data_cleansing_dev/visualization_dev/All BSOs Dashboards.xlsx"
bso_sheets = {
    "USFFC": "FFC Proj",
    "RESFOR": "RESFOR Proj",
    "PACFLT": "PACFLT Proj"
}

# Specify the KPI columns to plot
kpi_columns = [
    'NULOs that Remain High Priority',
    'Billing exceeds Authorization (Abnormal Unfilled Customer Orders)',
    'RBC Level- Total Negative Billed',
    'RBC Level- Total Negative Authorizations',
    'RON Level- Total Negative Reimbursable Collected',
    'Negative Liquidations - Travel (DTC: CS, CT, TO)',
    'Permanent Journal Vouchers',
    'OTA w/ Closed RON',
    'Negative Liquidations - Other',
    'OTA w/ Excluded Purchase Order (PO)',
    'Negative Liquidations - Foreign Currency',
    'Cost Transfer Allocation - "COE"',
    'ZMIL Negative Quantity / Positive Liquidation Amounts',
    'Cost Transfer Allocation - "L"',
    'Non-Labor Duplicates on SDN/ACRN/CLIN/SLIN',
    'Invalid LOA'
]

# Function to load and preprocess data for a BSO
def load_data(file_path, sheet_name):
    data = pd.read_excel(file_path, sheet_name=sheet_name)
    data['Date'] = pd.to_datetime(data['Date'], errors='coerce')
    data = data.dropna(subset=['Date'])  # Drop rows with invalid dates
    return data

# Function to plot KPIs for each BSO
def plot_kpis_for_bsos(file_path, bso_sheets, kpi_columns):
    for bso, sheet_name in bso_sheets.items():
        # Load data for the current BSO
        data = load_data(file_path, sheet_name)
        
        # Check if KPI columns exist in the data
        existing_kpis = [col for col in kpi_columns if col in data.columns]
        if not existing_kpis:
            print(f"No specified KPI columns found for BSO: {bso}")
            continue
        
        # Plot the KPIs
        plt.figure(figsize=(12, 6))
        for kpi in existing_kpis:
            plt.plot(data['Date'], data[kpi], label=kpi)
        
        # Add titles and labels
        plt.title(f"KPIs Over Time for BSO: {bso}", fontsize=14)
        plt.xlabel("Date", fontsize=12)
        plt.ylabel("KPI Values", fontsize=12)
        plt.legend(loc="upper left")
        plt.grid(True)
        
        # Show the plot
        plt.tight_layout()
        plt.show()

# Call the function to plot KPIs for all BSOs
plot_kpis_for_bsos(file_path, bso_sheets, kpi_columns)
